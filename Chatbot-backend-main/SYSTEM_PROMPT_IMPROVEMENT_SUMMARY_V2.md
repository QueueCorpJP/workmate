# システムプロンプト改善サマリー V2

## 改善の目的
ユーザーからの要望に基づき、より丁寧で適切な回答スタイルを実現するため、システム全体のプロンプトをさらにブラッシュアップしました。

## 新しい改善要件
- 回答は丁寧な敬語で行う
- **「ファイル名」や「資料名」までは明示して構いませんが、列番号、行番号、チャンク番号、データベースのIDなどの内部的な構造情報は一切出力しない**
- 代表者名や会社名など、ユーザーが聞いている情報だけを端的に答え、表形式やファイル構造の言及は不要
- 情報が見つからない場合も、失礼のない自然な日本語で「現在の資料には該当情報がございません」と案内
- 文末には「ご不明な点がございましたら、お気軽にお申し付けください。」と添える

## 改善されたファイル

### 1. ultra_accurate_rag.py
**改善箇所：** 291行目のbase_prompt
**改善内容：**
- 「頼れるパートナー」から「丁寧で親切なアシスタント」に変更
- 内部構造情報の非表示を明確に指定
- 敬語での回答を義務化
- 定型文の追加

### 2. realtime_rag.py
**改善箇所：** 316行目のprompt
**改善内容：**
- 「サポートスタッフ」から「丁寧で親切なアシスタント」に変更
- 内部構造情報の非表示を明確に指定
- 敬語での回答を義務化
- 定型文の追加

### 3. chat.py
**改善箇所：** 複数箇所（1089行目、1682行目、2273行目）
**改善内容：**
- 全てのプロンプトで統一された指針を適用
- 内部構造情報の非表示を明確に指定
- 敬語での回答を義務化
- 定型文の追加

### 4. chat_realtime_rag.py
**改善箇所：** 342行目のprompt
**改善内容：**
- 「サポートスタッフ」から「丁寧で親切なアシスタント」に変更
- 内部構造情報の非表示を明確に指定
- 敬語での回答を義務化
- 定型文の追加

## 改善のポイント

### 1. 統一された回答スタイル
- **改善前：** 各ファイルで異なる表現
- **改善後：** 全ファイルで統一された丁寧な敬語スタイル

### 2. 内部情報の非表示
- **新規追加：** 列番号、行番号、チャンク番号、データベースIDなどの内部構造情報を一切出力しない
- **効果：** よりユーザーフレンドリーで自然な回答

### 3. 端的で自然な回答
- **改善前：** 技術的な詳細や構造の説明
- **改善後：** ユーザーが求める情報のみを端的に提供

### 4. 適切な案内文
- **新規追加：** 情報が見つからない場合の丁寧な案内
- **新規追加：** 文末の定型文「ご不明な点がございましたら、お気軽にお申し付けください。」

## 期待される効果

1. **ユーザー体験の大幅向上**
   - より丁寧で親しみやすい対話
   - 技術的な情報の非表示による自然な回答

2. **回答品質の向上**
   - 統一された敬語での回答
   - 端的で分かりやすい情報提供

3. **プロフェッショナルな印象**
   - 一貫した丁寧な対応
   - 適切な案内とフォローアップ

## 技術的な影響

- 既存のAPI仕様に変更なし
- データベーススキーマに影響なし
- 既存の機能は全て維持
- プロンプトの改善のみで、システムの安定性に影響なし

## 今後の展開

この改善により、チャットボットはより丁寧で適切な回答スタイルを実現できるようになりました。内部構造情報の非表示により、ユーザーにとってより自然で分かりやすい対話が可能になります。