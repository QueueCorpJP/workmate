# OCR機能の追加について

## 概要
このアップデートでは、Gemini APIを活用したOCR（光学文字認識）機能を追加しました。これにより、テキストベースではないPDF（スキャンされたドキュメントや画像ベースのPDF）からもテキストを抽出できるようになりました。

## 主な機能
1. PDFファイルがテキストベースかどうかを自動的に判断
2. テキスト抽出が不十分な場合、PDFページを画像に変換
3. Gemini APIのビジョン機能を使用して画像からテキストを抽出
4. 抽出されたテキストを知識ベースに追加

## 技術的な詳細

### 判断基準
PDFがテキストベースかどうかは以下の基準で判断されます：
- テキストが含まれるページの割合が50%未満
- ページあたりの平均テキスト長が100文字未満

### 使用ライブラリ
- `pdf2image`: PDFページを画像に変換
- `google.generativeai`: Gemini APIを使用してOCR処理を実行
- `PyPDF2`: PDFからのテキスト抽出を試行
- `PIL (Pillow)`: 画像処理

## 使用方法
通常のPDFアップロード機能と同じように使用できます。システムが自動的にPDFの種類を判断し、適切な処理を行います。

1. 管理画面からPDFファイルをアップロード
2. システムがPDFを分析し、テキストベースかどうかを判断
3. テキストベースでない場合、OCR処理が自動的に実行される
4. 処理されたテキストが知識ベースに追加される

## 注意事項
1. OCR処理はテキスト抽出よりも時間がかかる場合があります
2. OCRで抽出されたテキストには「(OCR)」というマークが付きます
3. OCR処理の精度は画像の品質に依存します
4. 大量のページを含むPDFの場合、処理に時間がかかる場合があります

## 依存関係のインストール
OCR機能を使用するには、以下のライブラリが必要です：

```bash
pip install pdf2image pillow google-generativeai
```

Windowsの場合、`pdf2image`を使用するには追加で[Poppler for Windows](https://github.com/oschwartz10612/poppler-windows/releases/)をインストールし、パスを通す必要があります。

## トラブルシューティング
- OCR処理中にエラーが発生した場合でも、他のページの処理は継続されます
- 特定のページでOCR処理に失敗した場合は、ログにエラーメッセージが記録されます